(function(){var c=KISSY,g=c.Event,i=c.DOM,a=c.IO;var b=(window.ExtraCaja=window.ExtraCaja||{});var e=(b.GS=b.GS||{});e.initAll=e.initAll||[];var d="#J_TCajaGenToken";var f="tempCajaIframe";function h(k){e.addListener=e.addListener||function(n,m){if(!e.addListener.Fncs[n]){e.addListener.Fncs[n]=[]}e.addListener.Fncs[n].push(m)};e.addListener.Fncs=e.addListener.Fncs||[];function j(m,n){var p=i.create("<iframe id=''"+f+"' name='"+f+"'></iframe>");i.css(p,"display","none");var o=i.create('<form action="'+m+'" target="'+f+'" method="post"  enctype="multipart/form-data"></form>');i.css(p,"display","none");var l=i.create('<input type="hidden" name="token" value="'+n+'"/>');o.appendChild(l);return{form:o,iframe:p}}g.delegate(document,"change","input.J_TCajaUploadImg",function(o){var m=o.target;var n=j(i.attr(m,"data-url"),1);i.append(m,n.form);document.body.appendChild(n.iframe);document.body.appendChild(n.form);n.form.submit();var l=function(p){if(e.addListener.Fncs.cajaupload){for(var q=0;q<e.addListener.Fncs.cajaupload.length;q++){e.addListener.Fncs.cajaupload[q](p)}}};g.on(window,"cajaupload",function(q){q={content:q.content};k.markReadOnlyRecord(q);var p=k.tame(q);l(p);g.remove(window,"cajaupload");i.remove(n.iframe);i.remove(n.form)})})}e.initAll.push(h)})();